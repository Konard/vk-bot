const { gratitudeTrigger, outgoingGratitudeResponseStickerId } = require('../../triggers/gratitude');
const { enqueueMessage } = require('../../outgoing-messages');
jest.mock('../../outgoing-messages');

describe('gratitudeTrigger', () => {
  beforeEach(() => {
    enqueueMessage.mockClear();
  });

  test.each([
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ! ðŸ™â™¥ðŸ™'],
    ['ðŸ™‚Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð’Ð°Ð¼.'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ Ð’Ð°Ñ!. ðŸ˜'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ð´Ð¾Ñ€Ð¾Ð³Ð¾Ð¹!)'],
    ['Ð¡ÑÐ±'],
    ['Ð¿Ð°ÑÐ¸Ð±Ð°'],
    ['ÑÐ¿Ñ â˜º'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾Ñ‡ÐºÐ¸'],

    ["Bol'shoye spasibo! ðŸ‘"],
    
    ['ÐžÑ‚ Ð’ÑÐµÐ¹ Ð”ÑƒÑˆÐ¸âœ‹ðŸ‘‹'],
    
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ, Ð¼Ð½Ðµ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾âœ¨âœ¨âœ¨'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ! ÐžÑ‡ÐµÐ½ÑŒ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾ÐµðŸ™ðŸ’•!!! ÐœÐ½Ðµ Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾!)))'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ, Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾.)'],

    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ðŸ¤'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ðŸŒ¹'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ, ÑÐ¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ,,!'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð¸Ð¼ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ðŸ˜‰'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ!'],

    ['ÐŸÑ€Ð¸Ð²ÐµÑ‚!)\nÐ¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð¾Ð³Ñ€Ð¾Ð¼Ð½Ð¾Ðµ â˜º'],

    ['ÐšÐ¾ÑÑ‚Ñ ÑÐ¿Ð°ÑÐ¸Ð±Ð¾ â¤'],
    ['ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½, Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ!'],
    ['ÐžÐ³Ñ€Ð¾Ð¼Ð½ÐµÐ¹ÑˆÐµÐµ ÑÐ¿Ð°ÑÐ¸Ð±Ð¾ ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½!ðŸ‘'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ, ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½!) ðŸ™'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸ Ð¿Ð¾Ð¶ÐµÐ»Ð°Ð½Ð¸Ñ, ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½!!!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½!'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ ÐšÐ¾ÑÑ‚ÑŒ) ðŸ¤ðŸ¤ðŸ¤'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½! ðŸ’¥'],
    ['ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½ Ð¿Ñ€Ð¸Ð²ÐµÑ‚! Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ!â˜ºðŸ‘'],
    ['ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½, Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ Ð’Ð°Ð¼ ÑÐ¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¿Ð¾Ð·Ð´Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ!!!'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ, ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½!'],
    ['ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½, ÑÐ¿Ð°ÑÐ¸Ð±Ð¾!'],
    ['Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ Ñ‚ÐµÐ±Ñ ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½ ðŸ«¶'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ ÐšÐ¾ÑÑ‚Ñ'],
    ['Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ ÐšÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚Ð¸Ð½! ðŸ¤'],
  ])('matches "%s" greeting trigger and gives expected response', (incomingMessage) => {
    // console.log('incomingMessage', incomingMessage);
    const context = { request: { isFromUser: true, isOutbox: false, text: incomingMessage } };
    expect(gratitudeTrigger.condition(context)).toBe(true);
    if (gratitudeTrigger.condition(context)) {
      gratitudeTrigger.action(context);
    }
    expect(enqueueMessage).toHaveBeenCalled();
    const callArg = enqueueMessage.mock.calls[0][0];
    expect(callArg).toEqual(expect.objectContaining(context));
    expect(callArg.response.sticker_id).toEqual(outgoingGratitudeResponseStickerId);
  });

  // test.each([
  //   ['Ð§ÐµÐ¼ Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÑˆÑŒÑÑ?'], 
  //   ['ÐšÐ°ÐºÐ°Ñ Ñ†ÐµÐ»ÑŒ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð² Ð´Ñ€ÑƒÐ·ÑŒÑ?']
  // ])('does not match "%s" question', (incomingMessage) => {
  //   const context = { request: { text: incomingMessage } };
  //   expect(gratitudeTrigger.condition(context)).toBe(false);
  //   if (gratitudeTrigger.condition(context)) {
  //     gratitudeTrigger.action(context);
  //   }
  //   expect(enqueueMessage).not.toHaveBeenCalled();
  // });
});